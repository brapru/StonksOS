#pragma once

#include "types.hpp"
#include "peripherals/base.hpp"

class Gpio {
private:
    struct GpioPinData {
	reg32 reserved;
	reg32 data[2];
    };

    struct GpioRegs {
	reg32 func_select[6];
	struct GpioPinData output_set;
	struct GpioPinData output_clear;
	struct GpioPinData level;
	struct GpioPinData ev_detect_status;
	struct GpioPinData re_detect_enable;
	struct GpioPinData fe_detect_enable;
	struct GpioPinData hi_detect_enable;
	struct GpioPinData lo_detect_enable;
	struct GpioPinData async_re_detect;
	struct GpioPinData async_fe_detect;
	reg32 reserved;
	reg32 pupd_enable;
	reg32 pupd_enable_clocks[2];
    };

public:
    typedef enum _GpioFunc {
	GFInput = 0,
	GFOutput = 1,
	GFAlt0 = 4,
	GFAlt1 = 5,
	GFAlt2 = 6,
	GFAlt3 = 7,
	GFAlt4 = 3,
	GFAlt5 = 2
    } GpioFunc;

    struct GpioRegs *get_gpio_regs_ptr()
    {
	return reinterpret_cast<struct GpioRegs *>(PBASE + 0x00200000);
    }

    void gpio_pin_set_func(u8 pinNumber, GpioFunc func);
    void gpio_pin_enable(u8 pinNumber);
};
